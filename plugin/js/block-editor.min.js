"use strict";function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}!function(a,b){function c(){return h("svg",{"aria-hidden":"true",role:"img",focusable:"false",viewBox:"0 0 256 256",height:"20",width:"20",className:"dashicon",style:{fill:"none",strokeWidth:16}},h("path",{d:"M 44,76 A 32,32 0 0 1 44,12 H 212 A 32,32 0 0 1 212,76 Z",style:{stroke:"#0000dd"}}),h("path",{d:"M 100,44 A 32,32 0 1 1 164,44 V 212 A 32,32 0 0 1 100,212 Z",style:{stroke:"#dd0000"}}),h("path",{d:"M 189.373,21.3726 A 32,32 0 0 1 234.627,66.6274 L 66.6269,234.627 A 32,32 0 0 1 21.3729,189.373 Z",style:{stroke:"#008800"}}))}function d(a){return a.faulty&&(a=b.assign({},a,{className:"crw-control-error",help:j("Select something.","crosswordsearch"),value:"",options:[{value:"",label:""}].concat(a.options)})),h(m.SelectControl,a)}function e(a){var b={tag:"crosswordsearch",type:"single",attrs:{mode:a.mode,project:a.project}};return void 0!==a.name&&(b.attrs.name=a.name),"build"===a.mode&&a.restricted?b.attrs.restricted="1":"solve"===a.mode&&"number"==typeof a.timer&&(b.attrs.timer=a.timer,a.submitting&&(b.attrs.submitting=1)),q.string(b)}function f(a,c){var d;if(d="build"===a.mode?b.filter(s,function(a){return"no"!==a.value}):b.filter(s,function(a){return"no"===a.value}),!a.project)return d;var e=b.find(c,function(b){return b.name===a.project});return e?(e.crosswords.forEach(function(a){d.push({value:a,label:a})}),d):d}function g(a){var c,e=a.attributes,g=a.setAttributes,i=a.setTimeout,l=a.posts;if(!l.data)return h(m.Notice,{status:"info",isDismissible:!1},j("Waiting for data...","crosswordsearch"));if(!l.data.projects.length)return h(m.Notice,{status:"error",isDismissible:!1},j("No projects found.","crosswordsearch"));var n={},o=[],p=l.data.projects,q=p.map(function(a){return a.name});e.mode&&e.project?(o=f(e,p),n.mode=b.findIndex(r,function(a){return a.value===e.mode})<0,n.project=!b.includes(q,e.project),n.solve="solve"===e.mode&&!n.project&&1===o.length,n.name=!n.project&&e.name.length&&b.findIndex(o,function(a){return a.value===e.name})<0,n.timer=void 0!==e.timer&&!/^\d+$/.test(e.timer)):i(function(){return g(b.assign({mode:"solve",project:q[0]},e))},0);var v=[];return b.filter(n,b.identity).length&&v.push(h(m.Notice,{status:"error",isDismissible:!1},j("The shortcode usage is faulty:","crosswordsearch"))),v.push(h(m.RadioControl,(c={label:j("Mode","crosswordsearch"),className:"crw-mode-control",selected:e.mode,options:r},_defineProperty(c,"className",n.mode||n.solve?"crw-control-error":void 0),_defineProperty(c,"help",n.mode?j("Select something.","crosswordsearch"):n.solve?k(j("There is no crossword in project %1$s.","crosswordsearch"),e.project):void 0),_defineProperty(c,"onChange",function(a){var b={mode:a};"build"===a?(b.timer=void 0,b.submitting=void 0):""===e.name&&(b.name=void 0),g(b)}),c)),h(d,{label:j("Project","crosswordsearch"),value:q.indexOf(e.project)<0?null:e.project,faulty:n.project,options:q.map(function(a){return{label:a,value:a}}),onChange:function(a){return g({project:a})}}),h(d,{label:j("Crossword","crosswordsearch"),value:""===e.name?"new":e.name||("build"===e.mode?"dft":"no"),faulty:n.name,help:"build"===e.mode?j("Preselect the crossword initially displayed. All crosswords remain selectable.","crosswordsearch"):j("Select one or let the user choose from all crosswords.","crosswordsearch"),options:o,onChange:function(a){var c,d=b.find(s,function(b){return b.value===a});d?"new"===d.value&&(c=""):c=a,g({name:c})}})),v.push("build"===e.mode?h(m.CheckboxControl,{heading:j("Save opportunities","crosswordsearch"),label:j("Restricted","crosswordsearch"),help:j("Uploads by restricted users must be reviewed.","crosswordsearch"),checked:e.restricted,onChange:function(a){return g({restricted:a?1:void 0})}}):h("div",{className:"crw-timer-control"},h(d,{label:j("Display timer","crosswordsearch"),value:e.timer>0?"backward":0===e.timer?"forward":"none",faulty:n.timer,options:t,onChange:function(a){g({timer:b.find(t,function(b){return b.value===a}).number})}}),h(u,{label:j("Allowed time","crosswordsearch"),timer:e.timer,setAttributes:g}),h(m.CheckboxControl,{heading:j("Submission","crosswordsearch"),label:j("Let users submit their result","crosswordsearch"),checked:e.submitting,disabled:"number"!=typeof e.timer,onChange:function(a){return g({submitting:a?1:void 0})}}))),v}var h=a.element.createElement,i=a.element.RawHTML,j=a.i18n.__,k=a.i18n.sprintf,l=a.blocks,m=(a.editor.InspectorControls,a.components),n=a.components.withAPIData,o=a.compose.withInstanceId,p=a.compose.withSafeTimeout,q=a.shortcode;a.i18n.setLocaleData(crwBasics.locale,"crosswordsearch");var r=[{value:"build",label:j("Design crosswords","crosswordsearch")},{value:"solve",label:j("Solve crosswords","crosswordsearch")}],s=[{value:"new",label:"<"+j("Empty Crossword","crosswordsearch")+">"},{value:"dft",label:"<"+j("First crossword","crosswordsearch")+">"},{value:"no",label:"<"+j("Choose from all","crosswordsearch")+">"}],t=[{value:"none",number:void 0,label:j("None","crosswordsearch")},{value:"forward",number:0,label:j("Open-ended","crosswordsearch")},{value:"backward",number:60,label:j("Countdown","crosswordsearch")}],u=o(function(a){var b=a.label,c=a.instanceId,d=a.setAttributes,e=a.timer;return h(m.BaseControl,{label:b,id:"inspector-range-control-"+c},h("input",{className:"components-range-control__number",type:"number","aria-label":b,min:"1",disabled:!(e>0),value:e,onChange:function(a){d({timer:Math.round(Number(a.target.value))})}}),"Â s")}),v=[{name:"mode",type:"string",importType:"string"},{name:"project",type:"string",importType:"string"},{name:"name",type:"string",importType:"string"},{name:"restricted",type:"number",importType:"string",coerce:!0},{name:"timer",type:"number",importType:"number"},{name:"submitting",type:"number",importType:"number",coerce:!0}];l.registerBlockType("crw-block-editor/shortcode",{title:j("Crosswordsearch Shortcode","crosswordsearch"),description:j("Define how a Crosswordsearch block should be displayed","crosswordsearch"),icon:h(c,null),category:"widgets",attributes:v.reduce(function(a,b){return a[b.name]={type:b.type},a},{}),transforms:{from:[{type:"shortcode",tag:"crosswordsearch",attributes:v.reduce(function(a,b){return a[b.name]={type:b.importType,shortcode:function(a){var c=a.named[b.name];return b.coerce?c?1:void 0:c}},a},{}),priority:15},{type:"block",blocks:["core/shortcode"],isMatch:function(a){var b=a.text,c=q.regexp("crosswordsearch");return c.exec(b)},transform:function(a){var b=a.text;return l.rawHandler({HTML:"<p>"+b+"</p>",mode:"BLOCKS"})},priority:15}]},supports:{customClassName:!1,className:!1,html:!1},edit:n(function(){return{posts:"/crosswordsearch/v1/projects/public"}})(p(function(a){return h(React.Fragment,null,h("div",{className:"wp-block-shortcode wp-block-preformatted crw-preview-block"},h("label",null,h(m.Dashicon,{icon:"shortcode"}),j("Shortcode","crosswordsearch")),h("pre",null,e(a.attributes))),h("div",{className:"crw-editor-block"},h(g,a)))})),save:function(a){return h(i,null,e(a.attributes))}})}(window.wp,window.lodash);