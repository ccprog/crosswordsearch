"use strict";!function(a,b){function c(){return h("svg",{"aria-hidden":"true",role:"img",focusable:"false",viewBox:"0 0 256 256",height:"20",width:"20",className:"dashicon",style:{fill:"none",strokeWidth:16}},h("path",{d:"M 44,76 A 32,32 0 0 1 44,12 H 212 A 32,32 0 0 1 212,76 Z",style:{stroke:"#0000dd"}}),h("path",{d:"M 100,44 A 32,32 0 1 1 164,44 V 212 A 32,32 0 0 1 100,212 Z",style:{stroke:"#dd0000"}}),h("path",{d:"M 189.373,21.3726 A 32,32 0 0 1 234.627,66.6274 L 66.6269,234.627 A 32,32 0 0 1 21.3729,189.373 Z",style:{stroke:"#008800"}}))}function d(a){return a.faulty&&b.assign(a,{className:"crw-control-error",help:j("Select something.","crosswordsearch"),value:"",options:[{value:"",label:""}].concat(a.options)}),h(n.SelectControl,a)}function e(a){var b={tag:"crosswordsearch",type:"single",attrs:{mode:a.mode,project:a.project}};return void 0!==a.name&&(b.attrs.name=a.name),"build"===a.mode&&a.restricted?b.attrs.restricted="1":"solve"===a.mode&&"number"==typeof a.timer&&(b.attrs.timer=a.timer,a.submitting&&(b.attrs.submitting=1)),r.string(b)}function f(a,c){var d;if(d="build"===a.mode?b.filter(t,function(a){return"no"!==a.value}):b.filter(t,function(a){return"no"===a.value}),!a.project)return d;var e=b.find(c,function(b){return b.name===a.project});return e?(e.crosswords.forEach(function(a){d.push({value:a,label:a})}),d):d}function g(a,c,e,g){if(!g.data)return h(n.Notice,{status:"info",isDismissible:"false"},j("Waiting for data...","crosswordsearch"));if(!g.data.projects.length)return h(n.Notice,{status:"error",isDismissible:"false"},j("No projects found.","crosswordsearch"));var i={},l=[],m=g.data.projects,o=m.map(function(a){return a.name});a.mode&&a.project?(l=f(a,m),i.mode=b.findIndex(s,function(b){return b.value===a.mode})<0,i.project=!b.includes(o,a.project),i.solve="solve"===a.mode&&1===l.length,i.name=!i.project&&a.name.length&&b.findIndex(l,function(b){return b.value===a.name})<0,i.timer=void 0!==a.timer&&!/^\d+$/.test(a.timer)):e(function(){return c(b.assign({mode:"solve",project:o[0]},a))},0);var p=[];return b.filter(i,b.identity).length&&p.push(h(n.Notice,{status:"error",isDismissible:"false"},j("The shortcode usage is faulty:","crosswordsearch"))),p.push(h(n.RadioControl,{label:j("Mode","crosswordsearch"),selected:a.mode,options:s,className:i.mode?"crw-control-error":void 0,help:i.mode?j("Select something.","crosswordsearch"):i.solve?k(j("There is no crossword in project %1$s.","crosswordsearch"),a.project):void 0,onChange:function(b){var d={mode:b};"build"===b?(d.timer=void 0,d.submitting=void 0):""===a.name&&(d.name=void 0),c(d)}}),h(d,{label:j("Project","crosswordsearch"),value:o.indexOf(a.project)<0?null:a.project,faulty:i.project,options:o.map(function(a){return{label:a,value:a}}),onChange:function(a){return c({project:a})}}),h(d,{label:j("Crossword","crosswordsearch"),value:""===a.name?"new":a.name||("build"===a.mode?"dft":"no"),faulty:i.name,help:"build"===a.name?j("Preselect the crossword initially displayed. All crosswords remain selectable.","crosswordsearch"):j("Select one or let the user choose from all crosswords.","crosswordsearch"),options:l,onChange:function(a){var d,e=b.find(t,function(b){return b.value===a});e?"new"===e.value&&(d=""):d=a,c({name:d})}})),"build"===a.mode?p.push(h(n.CheckboxControl,{heading:j("Save opportunities","crosswordsearch"),label:j("Restricted","crosswordsearch"),help:j("Uploads by restricted users must be reviewed.","crosswordsearch"),checked:a.restricted,onChange:function(a){return c({restricted:a?1:void 0})}})):p.push(h(d,{label:j("Display timer","crosswordsearch"),className:"crw-timer-control",value:a.timer>0?"backward":0===a.timer?"forward":"none",faulty:i.timer,options:u,onChange:function(a){c({timer:b.find(u,function(b){return b.value===a}).number})}}),h(v,{label:j("Allowed time","crosswordsearch"),timer:a.timer,setAttributes:c}),h(n.CheckboxControl,{heading:j("Submission","crosswordsearch"),label:j("Let users submit their result","crosswordsearch"),checked:a.submitting,disabled:"number"!=typeof a.timer,onChange:function(a){return c({submitting:a?1:void 0})}})),p}var h=a.element.createElement,i=a.element.RawHTML,j=a.i18n.__,k=a.i18n.sprintf,l=a.blocks,m=a.editor.InspectorControls,n=a.components,o=a.components.withAPIData,p=a.compose.withInstanceId,q=a.compose.withSafeTimeout,r=a.shortcode;a.i18n.setLocaleData(crwBasics.locale,"crosswordsearch");var s=[{value:"build",label:j("Design crosswords","crosswordsearch")},{value:"solve",label:j("Solve crosswords","crosswordsearch")}],t=[{value:"new",label:"<"+j("Empty Crossword","crosswordsearch")+">"},{value:"dft",label:"<"+j("First crossword","crosswordsearch")+">"},{value:"no",label:"<"+j("Choose from all","crosswordsearch")+">"}],u=[{value:"none",number:void 0,label:j("None","crosswordsearch")},{value:"forward",number:0,label:j("Open-ended","crosswordsearch")},{value:"backward",number:60,label:j("Countdown","crosswordsearch")}],v=p(function(a){var b=a.label,c=a.instanceId,d=a.setAttributes,e=a.timer;return h(n.BaseControl,{label:b,id:"inspector-range-control-"+c,className:"components-range-control crw-allowed-control"},h("input",{className:"components-range-control__number",type:"number","aria-label":b,min:"1",disabled:!(e>0),value:e,onChange:function(a){d({timer:Math.round(Number(a.target.value))})}}),"Â s")}),w=[{name:"mode",type:"string",importType:"string"},{name:"project",type:"string",importType:"string"},{name:"name",type:"string",importType:"string"},{name:"restricted",type:"number",importType:"string",coerce:!0},{name:"timer",type:"number",importType:"number"},{name:"submitting",type:"number",importType:"number",coerce:!0}];l.registerBlockType("crw-block-editor/shortcode",{title:j("Crosswordsearch Shortcode","crosswordsearch"),description:j("Define how a Crosswordsearch block should be displayed","crosswordsearch"),icon:h(c,null),category:"widgets",attributes:w.reduce(function(a,b){return a[b.name]={type:b.type},a},{}),transforms:{from:[{type:"shortcode",tag:"crosswordsearch",attributes:w.reduce(function(a,b){return a[b.name]={type:b.importType,shortcode:function(a){var c=a.named[b.name];return b.coerce?c?1:void 0:c}},a},{}),priority:15},{type:"block",blocks:["core/shortcode"],isMatch:function(a){var b=a.text,c=r.regexp("crosswordsearch");return c.exec(b)},transform:function(a){var b=a.text;return l.rawHandler({HTML:"<p>"+b+"</p>",mode:"BLOCKS"})},priority:15}]},supports:{customClassName:!1,className:!1,html:!1},edit:o(function(){return{posts:"/crosswordsearch/v1/projects/public"}})(q(function(a){var b=a.attributes,d=a.setAttributes,f=a.setTimeout,i=a.posts;return h("div",{className:"wp-block-shortcode wp-block-preformatted"},h("label",null,h(c,null),j("Shortcode","crosswordsearch")),h("pre",null,e(b)),h(m,null,g(b,d,f,i)))})),save:function(a){return h(i,null,e(a.attributes))}})}(window.wp,window.lodash);