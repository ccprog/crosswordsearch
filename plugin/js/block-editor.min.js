!function(a,b){"use strict";function c(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function d(){return j("svg",{"aria-hidden":"true",role:"img",focusable:"false",viewBox:"-16 -16 288 288",style:{fill:"none",strokeWidth:16}},j("path",{d:"M 44,76 A 32,32 0 0 1 44,12 H 212 A 32,32 0 0 1 212,76 Z",style:{stroke:"#0000dd"}}),j("path",{d:"M 100,44 A 32,32 0 1 1 164,44 V 212 A 32,32 0 0 1 100,212 Z",style:{stroke:"#dd0000"}}),j("path",{d:"M 189.373,21.3726 A 32,32 0 0 1 234.627,66.6274 L 66.6269,234.627 A 32,32 0 0 1 21.3729,189.373 Z",style:{stroke:"#008800"}}))}function e(a){return{type:"projects",projects:a}}function f(a){return _.filter(D,function(b){return b.mode===a})}function g(a){return a.faulty&&(a=_.assign({},a,{className:"crw-control-error",help:b("Select something.","crosswordsearch"),value:"",options:[{value:"",label:""}].concat(a.options)})),j(r.SelectControl,a)}function h(a){var d,e=a.attributes,h=a.setAttributes,i=a.setTimeout,k=a.resolving,l=a.list,n=l.getProjectNames();if(k)return j(r.Notice,{status:"info",isDismissible:!1},b("Waiting for data...","crosswordsearch"));if(!n.length)return j(r.Notice,{status:"error",isDismissible:!1},b("No projects found.","crosswordsearch"));if(!e.mode||!e.project)return i(function(){return h({mode:"solve",project:n[0]})},0),null;var o=l.isFaulty(e);return j(React.Fragment,null,o.shortcode&&j(r.Notice,{status:"error",isDismissible:!1},b("The shortcode usage is faulty:","crosswordsearch")),j(r.RadioControl,(d={label:b("Mode","crosswordsearch"),className:"crw-mode-control",selected:e.mode,options:C},c(d,"className",o.mode||o.solve?"crw-control-error":void 0),c(d,"help",o.mode?b("Select something.","crosswordsearch"):o.solve?m(b("There is no crossword in project %1$s.","crosswordsearch"),e.project):void 0),c(d,"onChange",function(a){var b={mode:a};"build"===a?(b.timer=void 0,b.submitting=void 0):""===e.name&&(b.name=void 0),h(b)}),d)),j(g,{label:b("Project","crosswordsearch"),value:n.indexOf(e.project)<0?null:e.project,faulty:o.project,options:n.map(function(a){return{label:a,value:a}}),onChange:function(a){return h({project:a})}}),j(g,{label:b("Crossword","crosswordsearch"),value:""===e.name?"new":e.name||("build"===e.mode?"dft":"no"),faulty:o.name,help:"build"===e.mode?b("Preselect the crossword initially displayed. All crosswords remain selectable.","crosswordsearch"):b("Select one or let the user choose from all crosswords.","crosswordsearch"),options:l.getNameOptions(e),onChange:function(a){var b=f(e.mode),c=_.find(b,function(b){return b.value===a});return h({name:c?c.attr:a})}}),"build"===e.mode?j(r.CheckboxControl,{heading:b("Save opportunities","crosswordsearch"),label:b("Restricted","crosswordsearch"),help:b("Uploads by restricted users must be reviewed.","crosswordsearch"),checked:e.restricted,onChange:function(a){return h({restricted:a?1:void 0})}}):j("div",{className:"crw-timer-control"},j(g,{label:b("Display timer","crosswordsearch"),value:e.timer>0?"backward":0===e.timer?"forward":"none",faulty:o.timer,options:E,onChange:function(a){h({timer:_.find(E,function(b){return b.value===a}).number})}}),j(H,{label:b("Allowed time","crosswordsearch"),timer:e.timer,setAttributes:h}),j(r.CheckboxControl,{heading:b("Submission","crosswordsearch"),label:b("Let users submit their result","crosswordsearch"),checked:e.submitting,disabled:"number"!=typeof e.timer,onChange:function(a){return h({submitting:a?1:void 0})}})))}function i(a){var b={tag:"crosswordsearch",type:"single",attrs:{mode:a.mode,project:a.project}};return void 0!==a.name&&(b.attrs.name=a.name),"build"===a.mode&&a.restricted?b.attrs.restricted="1":"solve"===a.mode&&"number"==typeof a.timer&&(b.attrs.timer=a.timer,a.submitting&&(b.attrs.submitting=1)),B.string(b)}var j=a.element.createElement,k=a.element.RawHTML,l=a.i18n,b=l.__,m=l.sprintf,n=l.setLocaleData,o=a.blocks,p=o.registerBlockType,q=o.rawHandler,r=a.components,s=a.nux.DotTip,t=a.compose,u=t.withInstanceId,v=t.withSafeTimeout,w=a.data,x=w.registerStore,y=w.withSelect,z=w.select,A=a.apiFetch,B=a.shortcode;n(crwBasics.locale,"crosswordsearch");var C=[{value:"build",label:b("Design crosswords","crosswordsearch")},{value:"solve",label:b("Solve crosswords","crosswordsearch")}],D=[{value:"new",mode:"build",attr:"",label:"<"+b("Empty Crossword","crosswordsearch")+">"},{value:"dft",mode:"build",label:"<"+b("First crossword","crosswordsearch")+">"},{value:"no",mode:"solve",label:"<"+b("Choose from all","crosswordsearch")+">"}],E=[{value:"none",number:void 0,label:b("None","crosswordsearch")},{value:"forward",number:0,label:b("Open-ended","crosswordsearch")},{value:"backward",number:60,label:b("Countdown","crosswordsearch")}],F="crosswordsearch/data",G={getProject:function(a){return _.find(this.projects,function(b){return b.name===a})},getProjectNames:function(){return this.projects.map(function(a){return a.name})},getNameOptions:function(a){var b=f(a.mode),c=this.getProject(a.project);return c&&c.crosswords.forEach(function(a){b.push({value:a,label:a})}),b},isFaulty:function(a){var b={mode:_.findIndex(C,function(b){return b.value===a.mode})<0,project:!_.includes(this.getProjectNames(),a.project),timer:void 0!==a.timer&&!/^\d+$/.test(a.timer)};if(!b.project){var c=this.getProject(a.project).crosswords;b.solve="solve"===a.mode&&!c.length,b.name=a.name&&c.indexOf(a.name)<0}return _.assign({shortcode:_.filter(b).length>0},_.pickBy(b))}};x(F,{reducer:function(a,b){return{projects:b.projects||[]}},actions:{setProjects:e},selectors:{getPublicList:function(a){return _.create(G,a)},isResolvingList:function(){return z("core/data").isResolving(F,"getPublicList")}},resolvers:{getPublicList:function(){var a=new FormData;return a.append("action","get_crw_public_list"),a.append("_crwnonce",crwBasics.nonce),A({url:crwBasics.ajaxUrl,method:"POST",body:a}).then(function(a){return crwBasics.nonce=a.nonce,e(a.projects)})}}});var H=u(function(a){var b=a.label,c=a.instanceId,d=a.setAttributes,e=a.timer;return j(r.BaseControl,{label:b,id:"timer-range-control-".concat(c)},j("input",{id:"timer-range-control-".concat(c),className:"components-range-control__number",type:"number","aria-label":b,min:"1",disabled:!(e>0),value:"number"==typeof e?e:"",onChange:function(a){d({timer:Math.round(Number(a.target.value))})}}),"Â s")}),I=[{name:"mode",type:"string",importType:"string"},{name:"project",type:"string",importType:"string"},{name:"name",type:"string",importType:"string"},{name:"restricted",type:"number",importType:"string",coerce:!0},{name:"timer",type:"number",importType:"number"},{name:"submitting",type:"number",importType:"number",coerce:!0}];p("crw-block-editor/shortcode",{title:b("Crosswordsearch Shortcode","crosswordsearch"),description:b("Define how a Crosswordsearch block should be displayed","crosswordsearch"),icon:j(d,null),category:"widgets",attributes:I.reduce(function(a,b){return a[b.name]={type:b.type},a},{}),transforms:{from:[{type:"shortcode",tag:"crosswordsearch",attributes:I.reduce(function(a,b){return a[b.name]={type:b.importType,shortcode:function(a){var c=a.named[b.name];return b.coerce?c?1:void 0:c}},a},{}),priority:15},{type:"block",blocks:["core/shortcode"],isMatch:function(a){var b=a.text,c=B.regexp("crosswordsearch");return c.exec(b)},transform:function(a){var b=a.text;return q({HTML:"<p>"+b+"</p>",mode:"BLOCKS"})},priority:15}]},supports:{customClassName:!1,className:!1,html:!1},edit:y(function(a,b){var c=(b.attributes,a(F));return{list:c.getPublicList(),resolving:c.isResolvingList()}})(v(function(a){var c="crw-editor-block";return a.isSelected&&(c+=" crw-editor-selected"),j(React.Fragment,null,j("div",{className:"wp-block-shortcode wp-block-preformatted crw-preview-block"},j(s,{id:"crw/understand-shortcode"},b("Crosswordsearch has no visual preview.","crosswordsearch")+" ",b('Its representation as a "shortcode" is, for now, a way to ease the transition from the classic editor to Gutenberg.',"crosswordsearch")+" ",b('Use the "Preview" button at the top to see the complete post including the rendered crossword block.',"crosswordsearch")),j("label",null,j(r.Dashicon,{icon:"shortcode"}),b("Shortcode","crosswordsearch")),j("pre",null,i(a.attributes))),j("div",{className:c},j(h,a)))})),save:function(a){return j(k,null,i(a.attributes))}})}(window.wp,window.lodash);