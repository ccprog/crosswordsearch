"use strict";function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}!function(a,b){function c(){return i("svg",{"aria-hidden":"true",role:"img",focusable:"false",viewBox:"0 0 256 256",height:"20",width:"20",className:"dashicon",style:{fill:"none",strokeWidth:16}},i("path",{d:"M 44,76 A 32,32 0 0 1 44,12 H 212 A 32,32 0 0 1 212,76 Z",style:{stroke:"#0000dd"}}),i("path",{d:"M 100,44 A 32,32 0 1 1 164,44 V 212 A 32,32 0 0 1 100,212 Z",style:{stroke:"#dd0000"}}),i("path",{d:"M 189.373,21.3726 A 32,32 0 0 1 234.627,66.6274 L 66.6269,234.627 A 32,32 0 0 1 21.3729,189.373 Z",style:{stroke:"#008800"}}))}function d(a){return{type:"projects",projects:a}}function e(a){return b.filter(C,function(b){return b.mode===a})}function f(a){return a.faulty&&(a=b.assign({},a,{className:"crw-control-error",help:l("Select something.","crosswordsearch"),value:"",options:[{value:"",label:""}].concat(a.options)})),i(r.SelectControl,a)}function g(a){var c,d=a.attributes,g=a.setAttributes,h=a.setTimeout,j=a.resolving,k=a.list,n=k.getProjectNames();if(j)return i(r.Notice,{status:"info",isDismissible:!1},l("Waiting for data...","crosswordsearch"));if(!n.length)return i(r.Notice,{status:"error",isDismissible:!1},l("No projects found.","crosswordsearch"));if(!d.mode||!d.project)return h(function(){return g({mode:"solve",project:n[0]})},0),null;var o=k.isFaulty(d);return i(React.Fragment,null,o.shortcode&&i(r.Notice,{status:"error",isDismissible:!1},l("The shortcode usage is faulty:","crosswordsearch")),i(r.RadioControl,(c={label:l("Mode","crosswordsearch"),className:"crw-mode-control",selected:d.mode,options:B},_defineProperty(c,"className",o.mode||o.solve?"crw-control-error":void 0),_defineProperty(c,"help",o.mode?l("Select something.","crosswordsearch"):o.solve?m(l("There is no crossword in project %1$s.","crosswordsearch"),d.project):void 0),_defineProperty(c,"onChange",function(a){var b={mode:a};"build"===a?(b.timer=void 0,b.submitting=void 0):""===d.name&&(b.name=void 0),g(b)}),c)),i(f,{label:l("Project","crosswordsearch"),value:n.indexOf(d.project)<0?null:d.project,faulty:o.project,options:n.map(function(a){return{label:a,value:a}}),onChange:function(a){return g({project:a})}}),i(f,{label:l("Crossword","crosswordsearch"),value:""===d.name?"new":d.name||("build"===d.mode?"dft":"no"),faulty:o.name,help:"build"===d.mode?l("Preselect the crossword initially displayed. All crosswords remain selectable.","crosswordsearch"):l("Select one or let the user choose from all crosswords.","crosswordsearch"),options:k.getNameOptions(d),onChange:function(a){var c=e(d.mode),f=b.find(c,function(b){return b.value===a});return g({name:f?f.attr:a})}}),"build"===d.mode?i(r.CheckboxControl,{heading:l("Save opportunities","crosswordsearch"),label:l("Restricted","crosswordsearch"),help:l("Uploads by restricted users must be reviewed.","crosswordsearch"),checked:d.restricted,onChange:function(a){return g({restricted:a?1:void 0})}}):i("div",{className:"crw-timer-control"},i(f,{label:l("Display timer","crosswordsearch"),value:d.timer>0?"backward":0===d.timer?"forward":"none",faulty:o.timer,options:D,onChange:function(a){g({timer:b.find(D,function(b){return b.value===a}).number})}}),i(H,{label:l("Allowed time","crosswordsearch"),timer:d.timer,setAttributes:g}),i(r.CheckboxControl,{heading:l("Submission","crosswordsearch"),label:l("Let users submit their result","crosswordsearch"),checked:d.submitting,disabled:"number"!=typeof d.timer,onChange:function(a){return g({submitting:a?1:void 0})}})))}function h(a){var b={tag:"crosswordsearch",type:"single",attrs:{mode:a.mode,project:a.project}};return void 0!==a.name&&(b.attrs.name=a.name),"build"===a.mode&&a.restricted?b.attrs.restricted="1":"solve"===a.mode&&"number"==typeof a.timer&&(b.attrs.timer=a.timer,a.submitting&&(b.attrs.submitting=1)),A.string(b)}var i=a.element.createElement,j=a.element.RawHTML,k=a.i18n,l=k.__,m=k.sprintf,n=k.setLocaleData,o=a.blocks,p=o.registerBlockType,q=o.rawHandler,r=a.components,s=a.compose,t=s.withInstanceId,u=s.withSafeTimeout,v=a.data,w=v.registerStore,x=v.withSelect,y=v.select,z=a.apiFetch,A=a.shortcode;n(crwBasics.locale,"crosswordsearch");var B=[{value:"build",label:l("Design crosswords","crosswordsearch")},{value:"solve",label:l("Solve crosswords","crosswordsearch")}],C=[{value:"new",mode:"build",attr:"",label:"<"+l("Empty Crossword","crosswordsearch")+">"},{value:"dft",mode:"build",label:"<"+l("First crossword","crosswordsearch")+">"},{value:"no",mode:"solve",label:"<"+l("Choose from all","crosswordsearch")+">"}],D=[{value:"none",number:void 0,label:l("None","crosswordsearch")},{value:"forward",number:0,label:l("Open-ended","crosswordsearch")},{value:"backward",number:60,label:l("Countdown","crosswordsearch")}],E="crosswordsearch/data",F="/crosswordsearch/v1/projects/public",G={getProject:function(a){return b.find(this.projects,function(b){return b.name===a})},getProjectNames:function(){return this.projects.map(function(a){return a.name})},getNameOptions:function(a){var b=e(a.mode),c=this.getProject(a.project);return c&&c.crosswords.forEach(function(a){b.push({value:a,label:a})}),b},isFaulty:function(a){var c={mode:b.findIndex(B,function(b){return b.value===a.mode})<0,project:!b.includes(this.getProjectNames(),a.project),timer:void 0!==a.timer&&!/^\d+$/.test(a.timer)};if(!c.project){var d=this.getProject(a.project).crosswords;c.solve="solve"===a.mode&&!d.length,c.name=a.name&&d.indexOf(a.name)<0}return b.assign({shortcode:b.filter(c).length>0},b.pickBy(c))}};w(E,{reducer:function(a,b){return{projects:b.projects||[]}},actions:{setProjects:d},selectors:{getPublicList:function(a){return b.create(G,a)},isResolvingList:function(){return y("core/data").isResolving(E,"getPublicList")}},resolvers:{getPublicList:function(){return z({path:F}).then(function(a){return d(a.projects)})}}});var H=t(function(a){var b=a.label,c=a.instanceId,d=a.setAttributes,e=a.timer;return i(r.BaseControl,{label:b,id:"timer-range-control-".concat(c)},i("input",{id:"timer-range-control-".concat(c),className:"components-range-control__number",type:"number","aria-label":b,min:"1",disabled:!(e>0),value:"number"==typeof e?e:"",onChange:function(a){d({timer:Math.round(Number(a.target.value))})}}),"Â s")}),I=[{name:"mode",type:"string",importType:"string"},{name:"project",type:"string",importType:"string"},{name:"name",type:"string",importType:"string"},{name:"restricted",type:"number",importType:"string",coerce:!0},{name:"timer",type:"number",importType:"number"},{name:"submitting",type:"number",importType:"number",coerce:!0}];p("crw-block-editor/shortcode",{title:l("Crosswordsearch Shortcode","crosswordsearch"),description:l("Define how a Crosswordsearch block should be displayed","crosswordsearch"),icon:i(c,null),category:"widgets",attributes:I.reduce(function(a,b){return a[b.name]={type:b.type},a},{}),transforms:{from:[{type:"shortcode",tag:"crosswordsearch",attributes:I.reduce(function(a,b){return a[b.name]={type:b.importType,shortcode:function(a){var c=a.named[b.name];return b.coerce?c?1:void 0:c}},a},{}),priority:15},{type:"block",blocks:["core/shortcode"],isMatch:function(a){var b=a.text,c=A.regexp("crosswordsearch");return c.exec(b)},transform:function(a){var b=a.text;return q({HTML:"<p>"+b+"</p>",mode:"BLOCKS"})},priority:15}]},supports:{customClassName:!1,className:!1,html:!1},edit:x(function(a,b){var c=(b.attributes,a(E));return{list:c.getPublicList(),resolving:c.isResolvingList()}})(u(function(a){return i(React.Fragment,null,i("div",{className:"wp-block-shortcode wp-block-preformatted crw-preview-block"},i("label",null,i(r.Dashicon,{icon:"shortcode"}),l("Shortcode","crosswordsearch")),i("pre",null,h(a.attributes))),i("div",{className:"crw-editor-block"},i(g,a)))})),save:function(a){return i(j,null,h(a.attributes))}})}(window.wp,window.lodash);